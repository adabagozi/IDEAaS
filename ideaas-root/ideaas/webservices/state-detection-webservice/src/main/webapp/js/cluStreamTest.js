//var outputTest = '{"result":[{"synthesis":[{"ss":"217.43221134418073","centroid":[{"feature_id":"1","ss":"14.216470158844304","feature_name":"X","ls":"5.101407360670294","status_center":"null","status_radius":"null","value":"1.7004691202234312"},{"feature_id":"2","ss":"203.2157411853364","feature_name":"Y","ls":"-24.59200885128542","status_center":"null","status_radius":"null","value":"-8.197336283761807"}],"record_number":"3","warning":"0","radius":"1.5457963654641884"},{"ss":"162.72840637424275","centroid":[{"feature_id":"1","ss":"141.9399310562968","feature_name":"X","ls":"-19.951169099069336","status_center":"null","status_radius":"null","value":"-6.650389699689779"},{"feature_id":"2","ss":"20.788475317945927","feature_name":"Y","ls":"7.5092273262634635","status_center":"null","status_radius":"null","value":"2.5030757754211543"}],"record_number":"3","warning":"0","radius":"1.9364221206925591"},{"ss":"340.3614359382161","centroid":[{"feature_id":"1","ss":"33.5559459804133","feature_name":"X","ls":"5.792749431868541","status_center":"null","status_radius":"null","value":"5.792749431868541"},{"feature_id":"2","ss":"306.8054899578028","feature_name":"Y","ls":"17.51586395122441","status_center":"null","status_radius":"null","value":"17.51586395122441"}],"record_number":"1","warning":"0","radius":"0.0"},{"ss":"255.60464514277623","centroid":[{"feature_id":"1","ss":"182.35482824995447","feature_name":"X","ls":"-13.503881969639489","status_center":"null","status_radius":"null","value":"-13.503881969639489"},{"feature_id":"2","ss":"73.24981689282177","feature_name":"Y","ls":"-8.558610687069589","status_center":"null","status_radius":"null","value":"-8.558610687069589"}],"record_number":"1","warning":"0","radius":"0.0"},{"ss":"382.2110178276997","centroid":[{"feature_id":"1","ss":"273.30924806786334","feature_name":"X","ls":"23.36052619913177","status_center":"null","status_radius":"null","value":"11.680263099565884"},{"feature_id":"2","ss":"108.9017697598364","feature_name":"Y","ls":"11.222965331737264","status_center":"null","status_radius":"null","value":"5.611482665868632"}],"record_number":"2","warning":"0","radius":"4.815415364163853"}],"input_data":[{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":3.4974632006162794},{"contexts_status":[],"name":"Y","id":2,"value":-8.238167472586364}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":-9.130196315420752},{"contexts_status":[],"name":"Y","id":2,"value":3.2455243340498474}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":-5.2825795782011955},{"contexts_status":[],"name":"Y","id":2,"value":1.3684821516441967}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":-5.538393205447388},{"contexts_status":[],"name":"Y","id":2,"value":2.8952208405694186}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":1.3926932007318396},{"contexts_status":[],"name":"Y","id":2,"value":-7.275734260487086}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":0.2112509593221743},{"contexts_status":[],"name":"Y","id":2,"value":-9.078107118211971}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":-13.503881969639489},{"contexts_status":[],"name":"Y","id":2,"value":-8.558610687069589}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":12.155739659294365},{"contexts_status":[],"name":"Y","id":2,"value":0.819599197901776}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":11.204786539837404},{"contexts_status":[],"name":"Y","id":2,"value":10.403366133835489}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":5.792749431868541},{"contexts_status":[],"name":"Y","id":2,"value":17.51586395122441}]}],"experiment_number":"0","summarised_data_prev_id":"","record_number_total":"10","is_stable":"false","extraction_time":"0.0","record_number_new":"10","interval_value":"0","summarised_data_stable_id":"","total_synthesis":"0","synthesis_discarted":"0","clustering_time":"0.0","old_synthesis":"0","feature_space_id":"0","timestamp_final":"Sun Sep 17 13:50:24 CEST 2017","context":{"context_parameters":[],"id":"0"},"timestamp_initial":"Mon Aug 01 02:00:00 CEST 2016","total_time":"0.0","clusters":[],"interval_type":"null","dimensions":[],"status":"ok","timestamp":"Sun Sep 17 13:50:24 CEST 2017"},{"synthesis":[{"ss":"72.2948996548715","centroid":[{"feature_id":"1","ss":"11.922550729334695","feature_name":"X","ls":"-0.7856676002208083","status_center":"null","status_radius":"null","value":"-0.15713352004416165"},{"feature_id":"2","ss":"60.372348925536805","feature_name":"Y","ls":"12.975788445354716","status_center":"null","status_radius":"null","value":"2.5951576890709434"}],"record_number":"5","warning":"0","radius":"2.774787479557451"},{"ss":"528.8892783897196","centroid":[{"feature_id":"1","ss":"262.9677561528598","feature_name":"X","ls":"22.919759846789137","status_center":"null","status_radius":"null","value":"11.459879923394569"},{"feature_id":"2","ss":"265.9215222368598","feature_name":"Y","ls":"22.48813871432447","status_center":"null","status_radius":"null","value":"11.244069357162235"}],"record_number":"2","warning":"0","radius":"2.585864580283178"},{"ss":"132.1936146429128","centroid":[{"feature_id":"1","ss":"56.240083727922915","feature_name":"X","ls":"7.499338886056751","status_center":"null","status_radius":"null","value":"7.499338886056751"},{"feature_id":"2","ss":"75.95353091498987","feature_name":"Y","ls":"-8.71513229474974","status_center":"null","status_radius":"null","value":"-8.71513229474974"}],"record_number":"1","warning":"0","radius":"0.0"},{"ss":"69.40741509329052","centroid":[{"feature_id":"1","ss":"36.35534785011782","feature_name":"X","ls":"6.029539605153765","status_center":"null","status_radius":"null","value":"6.029539605153765"},{"feature_id":"2","ss":"33.052067243172694","feature_name":"Y","ls":"5.749092732177199","status_center":"null","status_radius":"null","value":"5.749092732177199"}],"record_number":"1","warning":"0","radius":"0.0"},{"ss":"200.2092933506251","centroid":[{"feature_id":"1","ss":"148.5323918101293","feature_name":"X","ls":"-12.187386586554531","status_center":"null","status_radius":"null","value":"-12.187386586554531"},{"feature_id":"2","ss":"51.67690154049582","feature_name":"Y","ls":"-7.188664795391132","status_center":"null","status_radius":"null","value":"-7.188664795391132"}],"record_number":"1","warning":"0","radius":"0.0"},{"ss":"217.43221134418073","centroid":[{"feature_id":"1","ss":"14.216470158844304","feature_name":"X","ls":"5.101407360670294","status_center":"null","status_radius":"null","value":"1.7004691202234312"},{"feature_id":"2","ss":"203.2157411853364","feature_name":"Y","ls":"-24.59200885128542","status_center":"null","status_radius":"null","value":"-8.197336283761807"}],"record_number":"3","warning":"0","radius":"1.5457963654641884"},{"ss":"162.72840637424275","centroid":[{"feature_id":"1","ss":"141.9399310562968","feature_name":"X","ls":"-19.951169099069336","status_center":"null","status_radius":"null","value":"-6.650389699689779"},{"feature_id":"2","ss":"20.788475317945927","feature_name":"Y","ls":"7.5092273262634635","status_center":"null","status_radius":"null","value":"2.5030757754211543"}],"record_number":"3","warning":"0","radius":"1.9364221206925591"},{"ss":"340.3614359382161","centroid":[{"feature_id":"1","ss":"33.5559459804133","feature_name":"X","ls":"5.792749431868541","status_center":"null","status_radius":"null","value":"5.792749431868541"},{"feature_id":"2","ss":"306.8054899578028","feature_name":"Y","ls":"17.51586395122441","status_center":"null","status_radius":"null","value":"17.51586395122441"}],"record_number":"1","warning":"0","radius":"0.0"},{"ss":"255.60464514277623","centroid":[{"feature_id":"1","ss":"182.35482824995447","feature_name":"X","ls":"-13.503881969639489","status_center":"null","status_radius":"null","value":"-13.503881969639489"},{"feature_id":"2","ss":"73.24981689282177","feature_name":"Y","ls":"-8.558610687069589","status_center":"null","status_radius":"null","value":"-8.558610687069589"}],"record_number":"1","warning":"0","radius":"0.0"},{"ss":"382.2110178276997","centroid":[{"feature_id":"1","ss":"273.30924806786334","feature_name":"X","ls":"23.36052619913177","status_center":"null","status_radius":"null","value":"11.680263099565884"},{"feature_id":"2","ss":"108.9017697598364","feature_name":"Y","ls":"11.222965331737264","status_center":"null","status_radius":"null","value":"5.611482665868632"}],"record_number":"2","warning":"0","radius":"4.815415364163853"}],"input_data":[{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":-0.34250168641287226},{"contexts_status":[],"name":"Y","id":2,"value":5.446513273085799}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":-1.5214370193761577},{"contexts_status":[],"name":"Y","id":2,"value":1.1632244808580001}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":7.499338886056751},{"contexts_status":[],"name":"Y","id":2,"value":-8.71513229474974}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":2.78476041720704},{"contexts_status":[],"name":"Y","id":2,"value":2.5704323423732482}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":-0.47939358012285815},{"contexts_status":[],"name":"Y","id":2,"value":4.685664008102849}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":-12.187386586554531},{"contexts_status":[],"name":"Y","id":2,"value":-7.188664795391132}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":-1.22709573151596},{"contexts_status":[],"name":"Y","id":2,"value":-0.8900456590651808}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":6.029539605153765},{"contexts_status":[],"name":"Y","id":2,"value":5.749092732177199}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":11.066141154909694},{"contexts_status":[],"name":"Y","id":2,"value":13.799781666823693}]},{"multi_dim_record":[{"contexts_status":[],"name":"X","id":1,"value":11.853618691879444},{"contexts_status":[],"name":"Y","id":2,"value":8.68835704750078}]}],"experiment_number":"0","summarised_data_prev_id":"null","record_number_total":"20","is_stable":"false","extraction_time":"0.0","record_number_new":"10","interval_value":"0","summarised_data_stable_id":"","total_synthesis":"0","synthesis_discarted":"0","clustering_time":"0.0","old_synthesis":"0","feature_space_id":"0","timestamp_final":"Sun Sep 17 13:50:24 CEST 2017","context":{"context_parameters":[],"id":"0"},"timestamp_initial":"Mon Aug 01 02:00:00 CEST 2016","total_time":"0.0","clusters":[],"interval_type":"null","dimensions":[],"status":"ok","timestamp":"Sun Sep 17 13:50:24 CEST 2017"}]}';

function readDataResult(resultArray) {
	console.log("readDataResult("+resultArray+") -> length: "+resultArray.length);
	if (resultArray.length>0) {
		$('#resultData').append(
						"<div class='row col-xs-12 margin_bottom20'><div class='col-xs-6 text-center'><h3>Generated Data</h3></div><div class='col-xs-6 text-center'><h3>Synthesis</h3></div></div>");
		keys = [resultArray[0]["synthesis"][0]["centroid"][0]["feature_name"], resultArray[0]["synthesis"][0]["centroid"][1]["feature_name"]];
		console.log(keys);
		
		var queue = [];
		for (var i = 0; i < resultArray.length; i++) {
			addElementsResultData(i);
			console.log("Result Data: " + resultArray[i]["synthesis"].length);
			
			var synthesis = buildSynthesis(resultArray[i]["synthesis"]);

			var inputData = buildInputData(resultArray[i]["input_data"]);
			
			queue.push({id: i, synthesis: synthesis, inputData: inputData});
			// plotGraph("graph"+id+""+i, newData, data2, keys);	
			// $('#loader'+id+""+i).hide();
		}

		plotAsync(queue, 0, keys);

	} else {
		$('#resultData').append('<div class="alert alert-danger text-center"><strong>No Results</strong></div>');
	}

	$('#loader').hide();
}

function addElementsResultData(id){
	var resultRowID="resultData"+id;
	var resultGraphSummarisedID="graphSummarised"+id;
	var resultGraphInputDataID="graphInputData"+id;

	$('#resultData').append("<div class='col-xs-12 loader' id='loader"+id+"'></div>" +
			"<div class='row col-xs-12 margin_bottom20'><div class='col-xs-6 text-center'>" +
			"<div id='"+resultGraphInputDataID+"' style='min-width: 310px; max-width: 600px; height: 400px; margin: 0 auto;'></div>" +
			"</div>" +
			"<div class='col-xs-6 text-center'>" +
			"<div id='"+resultGraphSummarisedID+"' style='min-width: 310px; max-width: 600px; height: 400px; margin: 0 auto;'></div>" +
			"</div></div>");
}

function buildSynthesis(synthesis){
	var data = [];
	synthesis.forEach(function(synthesi) {
		var numeroDati = parseFloat(synthesi["record_number"]);
		var raggio = 0;
		if(synthesi["radius"] != "NaN"){
			raggio = parseFloat(synthesi["radius"]);
		}
		var SS = parseFloat(synthesi["ss"]);

		var id = synthesi["id"];
		var parents = synthesi["parent_ids"];
		var X = parseFloat(synthesi["centroid"][0]["value"]);
		var Y = parseFloat(synthesi["centroid"][1]["value"]);
		// data.push([X, Y, raggio]);
		data.push({x: X, y: Y, z: raggio, numero: numeroDati, ss: SS, id: id, parents: parents});
	}, this);

	console.log("buildSynthesis: "+data.length);
	return data;
}
function buildInputData(inputData){
	var data = [];
	inputData.forEach(function(dataJson) {
		var numeroDati = 1;
		var raggio = 1;
		var X = parseFloat(dataJson["multi_dim_record"][0]["value"]);
		var Y = parseFloat(dataJson["multi_dim_record"][1]["value"]);
	//	console.log("X: "+X +" - Y: "+Y);
		// data.push({x: X, y: Y});
		data.push([X, Y]);
	}, this);
	console.log("buildInputData: "+data.length);

	return data;
}

function plotAsync(queue, id, keys){
	if(queue.length>0){
		setTimeout(function() {
			console.log(queue.length);
			var data = queue.shift();

			var resultGraphSummarisedID="graphSummarised"+id;
			var resultGraphInputDataID="graphInputData"+id;

			// data.sintesiIdeaas 
			plotGraph(resultGraphSummarisedID, data.synthesis, [], keys);	
			console.log(data.synthesis);
			plotGraphInputData(resultGraphInputDataID, data.inputData, [], keys)
			$('#loader'+id).hide();
	
			plotAsync(queue, id+1, keys);
		}, 2000);
	}
}


function plotGraph(id, synthesis, clusters, keys){
	Highcharts.chart(id, {
		chart : {
			type : 'bubble',
			plotBorderWidth : 1,
			zoomType : 'xy'
		},
		title : {
			text : 'Synthesis: '+synthesis.length
		},
		tooltip: {
			useHTML: true,
			headerFormat: '<table>',
			pointFormat: 
				'<tr><td>Id: {point.id}</td></tr>' +
				'<tr><td>Parents: {point.parents}</td></tr>' +
				'<tr><td>'+keys[0]+': {point.x:.2f}</td></tr>' +
				'<tr><td>'+keys[1]+': {point.y:.2f}</td></tr>' +
				'<tr><td>Radius: {point.z:.2f}</td></tr>' +
				'<tr><td>Data Number: {point.numero}</td></tr>',
			footerFormat: '</table>',
			followPointer: false
		},
	
		xAxis : {
			min: -20, 
			max: 20,
			gridLineWidth : 1,
			title: {
				text: keys[0]
			}
		},
		yAxis : {
			min: -20, 
			max: 20,
			startOnTick : false,
			endOnTick : false,
			title: {
				text: keys[1]
			}
		},
		series : [{
			name: 'Synthesis CluStream',
			data : synthesis,
			marker : {
				fillColor : {
					radialGradient : {
						cx : 0.4,
						cy : 0.3,
						r : 0.7
					},
					stops : [
							[ 0, 'rgba(255,255,255,0.5)' ],
							[1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0.5).get('rgba')] 
						]
				}
			}
		},
		{
			name: 'Centroids K-Means',
			data : clusters,
			marker : {
				fillColor : {
					radialGradient : {
						cx : 0.4,
						cy : 0.3,
						r : 0.7
					},
					stops : [
						[0, 'rgba(255,255,255,0.5)'],
						[1, Highcharts.Color(Highcharts.getOptions().colors[1]).setOpacity(0.5).get('rgba') ] 
					]
				}
			}
		}]
	});
}

function plotGraphInputData(id, newInputData, totalInputData, keys){
	console.log(keys);
	Highcharts.chart(id, {
		chart: {
        type: 'scatter',
        zoomType: 'xy'
    },
    title: {
        text: 'Generated Data'
    },
    xAxis: {
		min: -20, 
		max: 20,
        title: {
            enabled: true,
            text: keys[0]
        },
        startOnTick: true,
        endOnTick: true,
        showLastLabel: true
    },
    yAxis: {
		min: -20, 
		max: 20,
        title: {
            text: keys[1]
        }
    },
   plotOptions: {
        scatter: {
            marker: {
                radius: 5,
                states: {
                    hover: {
                        enabled: true,
                        lineColor: 'rgb(100,100,100)'
                    }
                }
            },
            states: {
                hover: {
                    marker: {
                        enabled: false
                    }
                }
            },
            tooltip: {
				useHTML: true,
				headerFormat: '<table>',
				pointFormat: '<tr><td>'+keys[0]+': {point.x:.2f}</td></tr>' +
						'<tr><td>'+keys[1]+': {point.y:.2f}</td></tr>',
			footerFormat: '</table>',
			followPointer: false
                // headerFormat: '<b>{series.name}</b><br>',
                // pointFormat: '{point.x} , {point.y} '
            }
        }
    },
    series: [{
        name: 'All Data',
        color: 'rgba(223, 83, 83, .5)',
        data: totalInputData

    }
	, {
        name: 'New Data',
        color: 'rgba(119, 152, 191, .5)',
        data: newInputData
		}
		]
	});
}
